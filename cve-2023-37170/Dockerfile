FROM liang2kl/fap-docker:2.3.1

ENV USER root
WORKDIR /root/firmware-analysis-plus

RUN sed -i s@/ports.ubuntu.com/@/mirrors.tuna.tsinghua.edu.cn/@g /etc/apt/sources.list && \
    grep -v '^deb http://security' /etc/apt/sources.list > /tmp/list && cat /tmp/list > /etc/apt/sources.list && rm /tmp/list && \
    apt-get clean && \
    apt-get update && apt-get install -y tmux rinetd && \
    apt-get autoremove --yes && rm -rf /var/lib/apt/lists/*

COPY A3300R_V17.0.0cu.557.web ./firmware.img
COPY start_fap.sh .

RUN chmod +x start_fap.sh

EXPOSE 80

CMD [ "./start_fap.sh" ]

#!/bin/bash
set -e

tmux new-session -d -s fap ./fap.py -q ./qemu-builds/2.5.0/ -b 0 ./squashfs.tar.gz
tmux send-keys -t fap Enter

echo "Waiting for firmware to boot..."
# Check http server state
bash -c 'while [[ "$(curl -s -o /dev/null -w ''%{http_code}'' 192.168.0.1:80)" != "200" ]]; do sleep 2; done'
echo "Server started!"

socat TCP6-LISTEN:23,fork,reuseaddr TCP:192.168.0.1:23 &
socat TCP6-LISTEN:80,fork,reuseaddr TCP:192.168.0.1:80 &
socat UDP6-LISTEN:1900,fork,reuseaddr UDP:192.168.0.1:1900 &

# Attack!

bash

FROM liang2kl/fap-docker:2.3.1

ENV USER root
WORKDIR /root/firmware-analysis-plus

RUN sed -i s@/ports.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list && apt-get clean && \
    apt-get update && apt-get install -y curl tmux openssh-server rinetd && \
    apt-get autoremove --yes && rm -rf /var/lib/apt/lists/*

RUN curl --insecure -o firmware.zip https://www.totolink.net/data/upload/20190823/7709dc2d95f5da71d8af89f5921f5ffb.zip && \
    unzip firmware.zip -d firmware && \
    mv firmware/**/*.web firmware.img && \
    rm -r firmware firmware.zip

COPY start_fap.sh .
COPY fap_alt.py .

RUN chmod +x start_fap.sh fap_alt.py

EXPOSE 80 22

CMD ["./start_fap.sh"]
